"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[886],{3529(e){e.exports=JSON.parse('{"permalink":"/blog/2021/05/06/Dynamic Volume Provisioning NFS","editUrl":"https://github.com/techslaves/techslaves.github.io/tree/master/website/blog/2021-05-06-Dynamic Volume Provisioning NFS.md","source":"@site/blog/2021-05-06-Dynamic Volume Provisioning NFS.md","title":"Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)","description":"In this post I will be covering details of configuring NFS dynamic provisioner on Bare Metal VM\'s. This article is part of series of Harbor High Availability","date":"2021-05-06T17:40:40.000Z","tags":[{"inline":true,"label":"Kubernetes","permalink":"/blog/tags/kubernetes"}],"readingTime":2.94,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)","excerpt":"In this post we will cover how to create storage volume (Persistent Volume) on demand in Kubernetes.","date":"2021-05-06 17:40:40 +0530","tags":["Kubernetes"]},"unlisted":false,"prevItem":{"title":"Post 04 - PostgreSQL High Availability deployment on Kubernetes","permalink":"/blog/2021/05/15/PostgeSQL High Availability deployment on Kubernetes"},"nextItem":{"title":"Bootstrap Kubernetes cluster with PV as NFS","permalink":"/blog/2021/01/14/Kubernetes"}}')},4380(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var s=i(3529),t=i(4848),r=i(8453);const a={title:"Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)",excerpt:"In this post we will cover how to create storage volume (Persistent Volume) on demand in Kubernetes.",date:"2021-05-06 17:40:40 +0530",tags:["Kubernetes"]},l=void 0,o={authorsImageUrls:[]},c=[{value:"<em>This article can also be used to configure NFS Dynamic Provisioning even if you are not installing Harbor High Availability.</em>",id:"this-article-can-also-be-used-to-configure-nfs-dynamic-provisioning-even-if-you-are-not-installing-harbor-high-availability",level:4}];function h(e){const n={a:"a",br:"br",code:"code",em:"em",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"In this post I will be covering details of configuring NFS dynamic provisioner on Bare Metal VM's. This article is part of series of Harbor High Availability"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Harbor High Availability deployment on Kubernetes ",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"/blog/2021/05/14/Harbor%20High%20Availability%20deployment%20on%20Kubernetes",children:"Post 01 - Harbor High Availability deployment on Kubernetes"})," \\"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Kubernetes Dynamic Provisioning - Persistent Volume on demand (Using helm charts) (this post)"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"High available Redis (Using helm charts)"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["High available PostgreSQL database (Using helm charts) ",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"/blog/2021/05/15/PostgeSQL%20High%20Availability%20deployment%20on%20Kubernetes",children:"Post 04 - PostgreSQL High Availability deployment on Kubernetes"})," \\"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Harbor High Availability deployment in action on Kubernetes using helm chart. \\"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"this-article-can-also-be-used-to-configure-nfs-dynamic-provisioning-even-if-you-are-not-installing-harbor-high-availability",children:(0,t.jsx)(n.em,{children:"This article can also be used to configure NFS Dynamic Provisioning even if you are not installing Harbor High Availability."})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Prerequisite"})}),"\n",(0,t.jsx)(n.p,{children:"NFS server is up and running."}),"\n",(0,t.jsx)(n.p,{children:"Read my previous post to create NFS server and bootstrap kubernetes using kubeadm."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/blog/2021/01/14/Kubernetes",children:"Bootstrap Kubernetes cluster with PV as NFS "})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"What is NFS dynamic provisioning"})})}),"\n",(0,t.jsx)(n.p,{children:"NFS dynamic provisioning allows PersistentVolume to be created on demand. There can be multiple storage class within a Kubernetes cluster which provide dynamic provisioning."}),"\n",(0,t.jsx)(n.p,{children:"One option is we have default storage class configured for the cluster and each time a PVC is raised a PV is automatically created.\nStorageclass can be marked as default using annotations under metadata."}),"\n",(0,t.jsx)(n.p,{children:"annotations:\nstorageclass.kubernetes.io/is-default-class=true"}),"\n",(0,t.jsx)(n.p,{children:"Other option is we have multiple dynamic provisioner configured and each time a PVC is raised it should be mentioned in yaml which provisioner user want to use to create underlying PV.\nThis can be achieved through mentioning storageclass in the yaml."}),"\n",(0,t.jsx)(n.p,{children:"Usually each cloud provider provides a Volume plugin which is used as provisioner in storageclass yaml to define where underlying PV will be created for PVC on demand."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"Using helm chart for dynamic provisioning"})})}),"\n",(0,t.jsx)("script",{src:"https://gist.github.com/techslaves/7f75665d4e31f68bd6ab9895dc47382f.js"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Default values of helm chart which are modified:"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"storageClass.reclaimPolicy :"}),'\nDefault value is "Delete", incase if you want to retain the pv for future use override this value to "Retain". This will help to reclaim the obsoleted volume\nFor instance you have a statefulset and you reduce the number of replica.\nThen again increase the number of replicas the old pv will still be lying and will automatically be attached with the new increased replica.']}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"storageClass.archiveOnDelete :"}),"\ndefault value is true, which will result in archiving the pv data lying on NFS server."]}),"\n",(0,t.jsx)(n.p,{children:"Above two overriden values will help to retain data with pv incase you uninstall and reinstall a same helm chart."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"replicaCount :"}),"\nIncreasing replica count to 3 for high availability. Which defaults to 1."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"storageClass.accessModes :"}),"\ndefault value is ReadWriteOnce(RWO). Other posssible values are ReadOnlyMany(ROX) and ReadWriteMany(RWX)\nReadWriteMany should be used when you want multiple pods(lying on multiple nodes) to write on same pv.\nNFS, CephFS and Glusterfs only supports all three types of access modes."]}),"\n",(0,t.jsx)(n.p,{children:"Run $kubectl get sc"}),"\n",(0,t.jsxs)(n.p,{children:["You should be able to see storage class with name ",(0,t.jsx)(n.code,{children:"nfs-client"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Using --kubeconfig parameter as I am installing helm chart from powershell from my Windows laptop on remote kubernetes cluster."})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Test automatic PV creation on NFS server"}),"*"]}),"\n",(0,t.jsx)(n.p,{children:"Create below PVC and check if underlying PV is created on NFS server automatically"}),"\n",(0,t.jsx)("script",{src:"https://gist.github.com/techslaves/5212e35f209a71a347d3c0b7bd576103.js"}),"\n",(0,t.jsx)(n.p,{children:"Run $  kubectl get pv, pvc"}),"\n",(0,t.jsx)(n.p,{children:"Above command will show PVC created from above yaml and underlying pv.\nGo to the nfs server on mount directory and one can find underlying pv folder."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE"}),"\nThis usecase was implemented was done on bare-metal cluster."]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>l});var s=i(6540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);