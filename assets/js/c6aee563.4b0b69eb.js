"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[885],{570(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS5-536d36499da34183f6007cbe4a5c4362.JPG"},762(e,s,n){n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>a});var t=n(2163),r=n(4848),i=n(8453);const c={title:"Bootstrap Kubernetes cluster with PV as NFS",excerpt:"In this post we will cover how to Bootstrap Kubernetes cluster using Kubeadm with underlying persistent volume as NFS",date:"2021-01-14 17:40:40 +0530",tags:["Kubernetes"]},o=void 0,d={authorsImageUrls:[]},a=[];function l(e){const s={a:"a",br:"br",code:"code",em:"em",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Create three ec2 instance"})}),"\n",(0,r.jsxs)(s.p,{children:["Master node : centos ",(0,r.jsx)(s.br,{}),"\n","Worker node: centos ",(0,r.jsx)(s.br,{}),"\n","NFS server : ubuntu"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Steps to create NFS Server on ubuntu instance"})}),"\n",(0,r.jsx)("script",{src:"https://gist.github.com/techslaves/70de4a76c0d72bf006c7d0572a081d1f.js"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(3470).A+"",width:"560",height:"148"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(7545).A+"",width:"564",height:"150"})}),"\n",(0,r.jsx)(s.p,{children:"Make sure you have below inbound rules for NFS client to ping to NFS server and mount directory on client-server"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(780).A+"",width:"553",height:"214"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Setup Master node (control plane) - Install Docker and Kubernetes (kubeadm, kubectl, kubelet)"})}),"\n",(0,r.jsx)("script",{src:"https://gist.github.com/techslaves/b5830e4a9155e3f85fb199ebb5774329.js"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(7351).A+"",width:"561",height:"290"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(570).A+"",width:"559",height:"292"})}),"\n",(0,r.jsx)(s.p,{children:"Add below Inbound rules with masternode of kubernetes cluster"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(1317).A+"",width:"772",height:"214"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Setup Worker Node"})}),"\n",(0,r.jsx)(s.p,{children:"Install Docker, kubeadm, kubelet and kubectl as done in above steps for master node"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Login to worker node"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Add below inbound rules on worker nodes (Without adding port TCP/UDP 2049/111 you won't be able to mount worker node on NFSdirectory)"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(9576).A+"",width:"725",height:"251"})}),"\n",(0,r.jsxs)(s.ol,{start:"3",children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Run token which you got from kubeadm init command:\n",(0,r.jsx)(s.code,{children:"$ kubeadm join 1X2.3X.4.XXX:6443 --token XXXXXXXXXXXXXXXXXXXXXXX\\ --discovery-token-ca-cert-hash sha256:XXXXXXXXXXXXX"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.code,{children:"$ sudo yum install nfs-util "})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(2195).A+"",width:"557",height:"295"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(4182).A+"",width:"558",height:"236"})}),"\n",(0,r.jsxs)(s.ol,{start:"5",children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"mount -t nfs :/srv/nfs/mydata /mnt "})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"mount | grep mydata"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:n(9588).A+"",width:"555",height:"32"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.strong,{children:"Create PV, PVC and POD's to Use NFS server as underlying storage:"})})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Login back to master node"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Run\n$kubectl get nodes (this should list one master and worker node as Ready)"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:"Create default nfs-storageclass.yaml"})}),"\n",(0,r.jsx)("script",{src:"https://gist.github.com/techslaves/44c423d5d887c1941df3ab23cbd37d3f.js"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.strong,{children:"Create nfs-pv.yaml file with below contents"})})}),"\n",(0,r.jsx)("script",{src:"https://gist.github.com/techslaves/3bf0f8f6728cd46db7c9dead33bf5168.js"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.strong,{children:"Create pvc.yaml"})})}),"\n",(0,r.jsx)("script",{src:"https://gist.github.com/techslaves/30229b3dfc3777d66cfdb3543215c06c.js"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.strong,{children:"Create nfs-deployment.yaml"})})}),"\n",(0,r.jsx)("script",{src:"https://gist.github.com/techslaves/d1999bb64a02e767fb1f16c673e4af33.js"}),"\n",(0,r.jsx)("script",{src:"https://gist.github.com/techslaves/0a86d2c1479ce24bfa9158bf2499afef.js"}),"\n",(0,r.jsx)(s.p,{children:"Any file created on location /usr/share/nginx/html will be backed up on NFS server location /srv/nfs/mydata"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.em,{children:(0,r.jsx)(s.strong,{children:"NOTE"})}),"\n** Contents of yaml can be found at ",(0,r.jsx)(s.a,{href:"https://github.com/techslaves/kubernetes/tree/main/deployment-pv-nfs",children:"TechSlaves Repo: deployment-pv-nfs"})," **"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},780(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS3-9ee76a93a1b6f2e356c0389363711791.JPG"},1317(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS6-27f30069d3498ca40118161f1724b0fa.JPG"},2163(e){e.exports=JSON.parse('{"permalink":"/blog/2021/01/14/Kubernetes","editUrl":"https://github.com/techslaves/techslaves.github.io/tree/master/website/blog/2021-01-14-Kubernetes.md","source":"@site/blog/2021-01-14-Kubernetes.md","title":"Bootstrap Kubernetes cluster with PV as NFS","description":"Create three ec2 instance","date":"2021-01-14T17:40:40.000Z","tags":[{"inline":true,"label":"Kubernetes","permalink":"/blog/tags/kubernetes"}],"readingTime":1.73,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Bootstrap Kubernetes cluster with PV as NFS","excerpt":"In this post we will cover how to Bootstrap Kubernetes cluster using Kubeadm with underlying persistent volume as NFS","date":"2021-01-14 17:40:40 +0530","tags":["Kubernetes"]},"unlisted":false,"prevItem":{"title":"Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)","permalink":"/blog/2021/05/06/Dynamic Volume Provisioning NFS"}}')},2195(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS8-d95da767e885ecfb02d2bc82b8a719b4.JPG"},3470(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS1-b3fef7d568d0e9cd58fb34e0004db2e2.JPG"},4182(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS9-dfa9c1c8f4ed0f3d253706d57df31b42.JPG"},7351(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS4-39504360db72928c2840caea0c7c87ad.JPG"},7545(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS2-b88d87cd6f958066f73388ebf3682610.JPG"},8453(e,s,n){n.d(s,{R:()=>c,x:()=>o});var t=n(6540);const r={},i=t.createContext(r);function c(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:s},e.children)}},9576(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS7-a0183ce83eaef279eb92ba721823c958.JPG"},9588(e,s,n){n.d(s,{A:()=>t});const t=n.p+"assets/images/NFS10-cf1594bd402af096667dcdfdfe074f4b.JPG"}}]);