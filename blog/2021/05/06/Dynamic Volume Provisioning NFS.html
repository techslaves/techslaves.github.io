<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts) | Utsav Garg</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://techslaves.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://techslaves.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://techslaves.github.io/blog/2021/05/06/Dynamic Volume Provisioning NFS"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts) | Utsav Garg"><meta data-rh="true" name="description" content="In this post I will be covering details of configuring NFS dynamic provisioner on Bare Metal VM&#x27;s. This article is part of series of Harbor High Availability"><meta data-rh="true" property="og:description" content="In this post I will be covering details of configuring NFS dynamic provisioner on Bare Metal VM&#x27;s. This article is part of series of Harbor High Availability"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-05-06T17:40:40.000Z"><meta data-rh="true" property="article:tag" content="Kubernetes"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://techslaves.github.io/blog/2021/05/06/Dynamic Volume Provisioning NFS"><link data-rh="true" rel="alternate" href="https://techslaves.github.io/blog/2021/05/06/Dynamic Volume Provisioning NFS" hreflang="en"><link data-rh="true" rel="alternate" href="https://techslaves.github.io/blog/2021/05/06/Dynamic Volume Provisioning NFS" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://techslaves.github.io/blog/2021/05/06/Dynamic Volume Provisioning NFS","mainEntityOfPage":"https://techslaves.github.io/blog/2021/05/06/Dynamic Volume Provisioning NFS","url":"https://techslaves.github.io/blog/2021/05/06/Dynamic Volume Provisioning NFS","headline":"Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)","name":"Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)","description":"In this post I will be covering details of configuring NFS dynamic provisioner on Bare Metal VM's. This article is part of series of Harbor High Availability","datePublished":"2021-05-06T17:40:40.000Z","author":[],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://techslaves.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Utsav Garg RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Utsav Garg Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-98116Q442C"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-98116Q442C",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.1575a16a.css">
<script src="/assets/js/runtime~main.926227ca.js" defer="defer"></script>
<script src="/assets/js/main.39da9792.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>Check out my YouTube channel! </span><a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/@techhustlewithUG" style="display: inline-block; background-color: #FF0000; color: #ffffff; padding: 4px 10px; border-radius: 4px; text-decoration: none; font-weight: bold; margin-left: 5px;">Subscribe ðŸ“º</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="TechHustlewithUG Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="TechHustlewithUG Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">TechHustlewithUG</b></a><a class="navbar__item navbar__link" href="/docs/youtube">YouTube</a><a class="navbar__item navbar__link" href="/docs/about">About Me</a><a class="navbar__item navbar__link" href="/docs/youtube">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/techslaves/techslaves.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/19/25/Dive - Into your docker images">Dive - Into docker images</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/05/14/Harbor High Availability deployment on Kubernetes">Post 01 - Harbor High Availability deployment on Kubernetes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/05/15/PostgeSQL High Availability deployment on Kubernetes">Post 04 - PostgreSQL High Availability deployment on Kubernetes</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2021/05/06/Dynamic Volume Provisioning NFS">Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/14/Kubernetes">Bootstrap Kubernetes cluster with PV as NFS</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Post 02 - Kubernetes Dynamic Provisioning, Persistent Volume on demand (Using helm charts)</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-05-06T17:40:40.000Z">May 6, 2021</time> Â· <!-- -->3 min read</div></header><div id="__blog-post-container" class="markdown"><p>In this post I will be covering details of configuring NFS dynamic provisioner on Bare Metal VM&#x27;s. This article is part of series of Harbor High Availability</p>
<ol>
<li class="">
<p>Harbor High Availability deployment on Kubernetes <br>
<a class="" href="/blog/2021/05/14/Harbor High Availability deployment on Kubernetes">Post 01 - Harbor High Availability deployment on Kubernetes</a> \</p>
</li>
<li class="">
<p>Kubernetes Dynamic Provisioning - Persistent Volume on demand (Using helm charts) (this post)</p>
</li>
<li class="">
<p>High available Redis (Using helm charts)</p>
</li>
<li class="">
<p>High available PostgreSQL database (Using helm charts) <br>
<a class="" href="/blog/2021/05/15/PostgeSQL High Availability deployment on Kubernetes">Post 04 - PostgreSQL High Availability deployment on Kubernetes</a> \</p>
</li>
<li class="">
<p>Harbor High Availability deployment in action on Kubernetes using helm chart. \</p>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="this-article-can-also-be-used-to-configure-nfs-dynamic-provisioning-even-if-you-are-not-installing-harbor-high-availability"><em>This article can also be used to configure NFS Dynamic Provisioning even if you are not installing Harbor High Availability.</em><a href="#this-article-can-also-be-used-to-configure-nfs-dynamic-provisioning-even-if-you-are-not-installing-harbor-high-availability" class="hash-link" aria-label="Direct link to this-article-can-also-be-used-to-configure-nfs-dynamic-provisioning-even-if-you-are-not-installing-harbor-high-availability" title="Direct link to this-article-can-also-be-used-to-configure-nfs-dynamic-provisioning-even-if-you-are-not-installing-harbor-high-availability" translate="no">â€‹</a></h4>
<p><strong>Prerequisite</strong></p>
<p>NFS server is up and running.</p>
<p>Read my previous post to create NFS server and bootstrap kubernetes using kubeadm.</p>
<ul>
<li class=""><a class="" href="/blog/2021/01/14/Kubernetes">Bootstrap Kubernetes cluster with PV as NFS </a></li>
</ul>
<p><em><strong>What is NFS dynamic provisioning</strong></em></p>
<p>NFS dynamic provisioning allows PersistentVolume to be created on demand. There can be multiple storage class within a Kubernetes cluster which provide dynamic provisioning.</p>
<p>One option is we have default storage class configured for the cluster and each time a PVC is raised a PV is automatically created.
Storageclass can be marked as default using annotations under metadata.</p>
<p>annotations:
storageclass.kubernetes.io/is-default-class=true</p>
<p>Other option is we have multiple dynamic provisioner configured and each time a PVC is raised it should be mentioned in yaml which provisioner user want to use to create underlying PV.
This can be achieved through mentioning storageclass in the yaml.</p>
<p>Usually each cloud provider provides a Volume plugin which is used as provisioner in storageclass yaml to define where underlying PV will be created for PVC on demand.</p>
<p><em><strong>Using helm chart for dynamic provisioning</strong></em></p>
<script src="https://gist.github.com/techslaves/7f75665d4e31f68bd6ab9895dc47382f.js"></script>
<p><strong>Default values of helm chart which are modified:</strong></p>
<p><em>storageClass.reclaimPolicy :</em>
Default value is &quot;Delete&quot;, incase if you want to retain the pv for future use override this value to &quot;Retain&quot;. This will help to reclaim the obsoleted volume
For instance you have a statefulset and you reduce the number of replica.
Then again increase the number of replicas the old pv will still be lying and will automatically be attached with the new increased replica.</p>
<p><em>storageClass.archiveOnDelete :</em>
default value is true, which will result in archiving the pv data lying on NFS server.</p>
<p>Above two overriden values will help to retain data with pv incase you uninstall and reinstall a same helm chart.</p>
<p><em>replicaCount :</em>
Increasing replica count to 3 for high availability. Which defaults to 1.</p>
<p><em>storageClass.accessModes :</em>
default value is ReadWriteOnce(RWO). Other posssible values are ReadOnlyMany(ROX) and ReadWriteMany(RWX)
ReadWriteMany should be used when you want multiple pods(lying on multiple nodes) to write on same pv.
NFS, CephFS and Glusterfs only supports all three types of access modes.</p>
<p>Run $kubectl get sc</p>
<p>You should be able to see storage class with name <code>nfs-client</code>.</p>
<p><em>Using --kubeconfig parameter as I am installing helm chart from powershell from my Windows laptop on remote kubernetes cluster.</em></p>
<p><strong>Test automatic PV creation on NFS server</strong>*</p>
<p>Create below PVC and check if underlying PV is created on NFS server automatically</p>
<script src="https://gist.github.com/techslaves/5212e35f209a71a347d3c0b7bd576103.js"></script>
<p>Run $  kubectl get pv, pvc</p>
<p>Above command will show PVC created from above yaml and underlying pv.
Go to the nfs server on mount directory and one can find underlying pv folder.</p>
<p><strong>NOTE</strong>
This usecase was implemented was done on bare-metal cluster.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/kubernetes">Kubernetes</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/techslaves/techslaves.github.io/tree/master/website/blog/2021-05-06-Dynamic Volume Provisioning NFS.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2021/05/15/PostgeSQL High Availability deployment on Kubernetes"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Post 04 - PostgreSQL High Availability deployment on Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2021/01/14/Kubernetes"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Bootstrap Kubernetes cluster with PV as NFS</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/certification">Certifications</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/youtube">YouTube Series</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/itsutsavgarg" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/itsutsavgarg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@techhustlewithUG" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/techslaves/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 TechHustlewithUG. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>